(window.webpackJsonp=window.webpackJsonp||[]).push([[263],{685:function(v,_,l){"use strict";l.r(_);var a=l(16),i=Object(a.a)({},(function(){var v=this,_=v.$createElement,l=v._self._c||_;return l("ContentSlotsDistributor",{attrs:{"slot-key":v.$parent.slotKey}},[l("h2",{attrs:{id:"概述"}},[l("a",{staticClass:"header-anchor",attrs:{href:"#概述"}},[v._v("#")]),v._v(" 概述")]),v._v(" "),l("p",[l("img",{attrs:{src:"https://s0.lgstatic.com/i/image6/M01/04/C2/Cgp9HWAuNm2ASt5qAAFXu-AqwBI232.png",alt:"性能优化体系"}})]),v._v(" "),l("h2",{attrs:{id:"性能优化步骤"}},[l("a",{staticClass:"header-anchor",attrs:{href:"#性能优化步骤"}},[v._v("#")]),v._v(" 性能优化步骤")]),v._v(" "),l("p",[v._v("针对前端全链路性能优化专题，我们依次做如下几个关键步骤")]),v._v(" "),l("ol",[l("li",[l("p",[v._v("确定优化范围和关键路径")])]),v._v(" "),l("li",[l("p",[v._v("拆开并定义关键指标")])]),v._v(" "),l("li",[l("p",[v._v("计算、收集、分析指标数据")])]),v._v(" "),l("li",[l("p",[v._v("执行具体优化方案")])]),v._v(" "),l("li",[l("p",[v._v("对比分析调整优化结果")])]),v._v(" "),l("li",[l("p",[v._v("灰度测试并完善数据指标")])]),v._v(" "),l("li",[l("p",[v._v("输出优化后完整的数据报表")])])]),v._v(" "),l("h2",{attrs:{id:"关键指标的设定"}},[l("a",{staticClass:"header-anchor",attrs:{href:"#关键指标的设定"}},[v._v("#")]),v._v(" 关键指标的设定")]),v._v(" "),l("ul",[l("li",[v._v("自动化检测\n"),l("ul",[l("li",[v._v("通过Lighthouse")]),v._v(" "),l("li",[v._v("Performance 面板")]),v._v(" "),l("li",[v._v("Chrome DevTools Protocol")])])]),v._v(" "),l("li",[v._v("手动检测\n- Performance API")])]),v._v(" "),l("p",[l("img",{attrs:{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/71cb8e5d5cfc4959a0a8ec8b27742ba1~tplv-k3u1fbpfcp-watermark.awebp",alt:""}})]),v._v(" "),l("p",[v._v("LCP: 加载性能。最大内容绘制应在 2.5s 内完成。")]),v._v(" "),l("p",[v._v("FID: 交互性能。首次输入延迟应在 100ms 内完成。")]),v._v(" "),l("p",[v._v("CLS: 页面稳定性。累积布局偏移，需手动计算，CLS 应保持在 0.1 以下。")]),v._v(" "),l("h3",{attrs:{id:"加载"}},[l("a",{staticClass:"header-anchor",attrs:{href:"#加载"}},[v._v("#")]),v._v(" 加载")]),v._v(" "),l("ul",[l("li",[l("p",[v._v("首屏时间=DOMContentLoaded 时间=domContentLoadedEventEnd-fetchStart")])]),v._v(" "),l("li",[l("p",[v._v("网络环境采集")])])]),v._v(" "),l("p",[v._v("两张不同尺寸的图片 下载时间/文件体积 求平均值")]),v._v(" "),l("ul",[l("li",[v._v("弱网优化")])]),v._v(" "),l("p",[v._v("白屏")]),v._v(" "),l("ul",[l("li",[v._v("白屏时间 FP= domLoading-navigationStart")])]),v._v(" "),l("h3",{attrs:{id:"交互"}},[l("a",{staticClass:"header-anchor",attrs:{href:"#交互"}},[v._v("#")]),v._v(" 交互")]),v._v(" "),l("ol",[l("li",[v._v("手动录制")]),v._v(" "),l("li",[v._v("自动化用 adb 录制视频；adb shell screenrecord --time--limt 10/sdcard/perf.mp4")]),v._v(" "),l("li",[v._v("白屏响应时间=白屏最后- 帧的时间- 点击时的起始帧时间")]),v._v(" "),l("li",[v._v("首屏加载时间=内容完全加载出来那一帧的时间-点击时的起始帧时间")])]),v._v(" "),l("ul",[l("li",[v._v("弱网环境测试")])]),v._v(" "),l("ol",[l("li",[v._v("2G/3G/4G 各种特殊场景测试")]),v._v(" "),l("li",[v._v("采用分帧计算")])]),v._v(" "),l("h3",{attrs:{id:"渲染"}},[l("a",{staticClass:"header-anchor",attrs:{href:"#渲染"}},[v._v("#")]),v._v(" 渲染")]),v._v(" "),l("h3",{attrs:{id:"构建"}},[l("a",{staticClass:"header-anchor",attrs:{href:"#构建"}},[v._v("#")]),v._v(" 构建")]),v._v(" "),l("ol",[l("li",[v._v("通过 Webpack "),l("strong",[v._v("speed-measure-webpack-plugin")]),v._v(" 插件测量构建时间")])]),v._v(" "),l("p",[v._v("拿到各阶段的loader和plugin插件执行占用时间")]),v._v(" "),l("ol",{attrs:{start:"2"}},[l("li",[v._v("通过 Webpack "),l("strong",[v._v("webpack-bundle-analyzer")]),v._v(" 测量构建体积")])]),v._v(" "),l("p",[v._v("拿到各js、css、html等文件大小")]),v._v(" "),l("h2",{attrs:{id:"指标收集"}},[l("a",{staticClass:"header-anchor",attrs:{href:"#指标收集"}},[v._v("#")]),v._v(" 指标收集")]),v._v(" "),l("h3",{attrs:{id:"收集方式"}},[l("a",{staticClass:"header-anchor",attrs:{href:"#收集方式"}},[v._v("#")]),v._v(" 收集方式")]),v._v(" "),l("ul",[l("li",[l("p",[v._v("用PerformanceAPI")])]),v._v(" "),l("li",[l("p",[v._v("使用三方库web-vitals")])]),v._v(" "),l("li",[l("p",[v._v("使用三方库sentry")])])]),v._v(" "),l("h3",{attrs:{id:"上送方式"}},[l("a",{staticClass:"header-anchor",attrs:{href:"#上送方式"}},[v._v("#")]),v._v(" 上送方式")]),v._v(" "),l("ul",[l("li",[l("p",[v._v("通过sendBeacon上报")])]),v._v(" "),l("li",[l("p",[v._v("通过gif")])])]),v._v(" "),l("h3",{attrs:{id:"上送策略"}},[l("a",{staticClass:"header-anchor",attrs:{href:"#上送策略"}},[v._v("#")]),v._v(" 上送策略")]),v._v(" "),l("ul",[l("li",[l("p",[v._v("数据过滤")])]),v._v(" "),l("li",[l("p",[v._v("数据抽样")])]),v._v(" "),l("li",[l("p",[v._v("socket 心跳链接，实时上送")])]),v._v(" "),l("li",[l("p",[v._v("http 满足30条上送，断点续传")])]),v._v(" "),l("li",[l("p",[v._v("弱网时候先存本地，强网时候立即上送")])])]),v._v(" "),l("h2",{attrs:{id:"加载过程优化-首屏秒开"}},[l("a",{staticClass:"header-anchor",attrs:{href:"#加载过程优化-首屏秒开"}},[v._v("#")]),v._v(" 加载过程优化（首屏秒开）")]),v._v(" "),l("h3",{attrs:{id:"网络方面"}},[l("a",{staticClass:"header-anchor",attrs:{href:"#网络方面"}},[v._v("#")]),v._v(" 网络方面")]),v._v(" "),l("ul",[l("li",[l("p",[v._v("DNS优化")]),v._v(" "),l("ul",[l("li",[v._v("NDS缓存")]),v._v(" "),l("li",[v._v("DNS预解析（dns-prefetch）")])])]),v._v(" "),l("li",[l("p",[v._v("使用http2.0")]),v._v(" "),l("ul",[l("li",[v._v("多路复用，在浏览器可并行发送 N 条请求。")]),v._v(" "),l("li",[v._v("首部压缩，更小的负载体积。")]),v._v(" "),l("li",[v._v("请求优先级，更快的关键请求")])])]),v._v(" "),l("li",[l("p",[v._v("使用CDN")])]),v._v(" "),l("li",[l("p",[v._v("利用缓存")]),v._v(" "),l("ul",[l("li",[v._v("强缓存（Last-modefiy）")]),v._v(" "),l("li",[v._v("协商缓存（Etag）")])])]),v._v(" "),l("li",[l("p",[v._v("开启Gzip/brotli")])])]),v._v(" "),l("h3",{attrs:{id:"服务端渲染"}},[l("a",{staticClass:"header-anchor",attrs:{href:"#服务端渲染"}},[v._v("#")]),v._v(" 服务端渲染")]),v._v(" "),l("ul",[l("li",[l("p",[v._v("SSR/SSG")])]),v._v(" "),l("li",[l("p",[v._v("PWA离线缓存")])]),v._v(" "),l("li",[l("p",[v._v("ServiceWorker")])])]),v._v(" "),l("h3",{attrs:{id:"懒加载-预加载"}},[l("a",{staticClass:"header-anchor",attrs:{href:"#懒加载-预加载"}},[v._v("#")]),v._v(" 懒加载/预加载")]),v._v(" "),l("ul",[l("li",[v._v("prefetch")])]),v._v(" "),l("p",[v._v("prefetch (预获取)：浏览器空闲的时候进行资源的拉取")]),v._v(" "),l("ul",[l("li",[v._v("preload")])]),v._v(" "),l("p",[v._v("preload (预加载)：提前加载后面会用到的关键资源\n⚠️ 因为会提前拉取资源，如果不是特殊需要，谨慎使用")]),v._v(" "),l("ul",[l("li",[l("p",[v._v("路由懒加载，无需加载整个应用的资源")])]),v._v(" "),l("li",[l("p",[v._v("降低白屏时间:")])])]),v._v(" "),l("ol",[l("li",[v._v("DNS 走缓存")]),v._v(" "),l("li",[v._v("开启 Dns 预解析 x-dns-prefetch-control")]),v._v(" "),l("li",[v._v("dns-prefetch 强制对 域名做预解析")]),v._v(" "),l("li",[v._v("端内：提前初始化 WebView 并且加载域名开始解析，端外：iframe")]),v._v(" "),l("li",[v._v("使用骨架屏幕, Cli+puppeteer")])]),v._v(" "),l("h3",{attrs:{id:"hybrid方面"}},[l("a",{staticClass:"header-anchor",attrs:{href:"#hybrid方面"}},[v._v("#")]),v._v(" Hybrid方面")]),v._v(" "),l("ul",[l("li",[l("p",[v._v("离线加载")]),v._v(" "),l("ul",[l("li",[v._v("创建预置（Js/css/html）压缩后的离线包")]),v._v(" "),l("li",[v._v("更新diff patch包")])])]),v._v(" "),l("li",[l("p",[v._v("预渲染（NSR渲染）")])]),v._v(" "),l("li",[l("p",[v._v("WebView预加载")]),v._v(" "),l("ul",[l("li",[v._v("native端预初始化Webview组件并隐藏,使用时候直接展示")])])]),v._v(" "),l("li",[l("p",[v._v("WebView池化")])]),v._v(" "),l("li",[l("p",[v._v("IOS使用WKWebview")]),v._v(" "),l("ul",[l("li",[v._v("降低内存占用")])])]),v._v(" "),l("li",[l("p",[v._v("弱网优化")]),v._v(" "),l("ul",[l("li",[v._v("接口合并")]),v._v(" "),l("li",[v._v("图片尽量用base64")]),v._v(" "),l("li",[v._v("不自动加载图片，只显示本占位图")])])]),v._v(" "),l("li",[l("p",[v._v("根据手机品牌(内存、cpu性能)")]),v._v(" "),l("ul",[l("li",[v._v("优化策略")]),v._v(" "),l("li",[v._v("时间换空间（内存小）")]),v._v(" "),l("li",[v._v("空间换时间（cpu差）")])])])]),v._v(" "),l("h2",{attrs:{id:"交互过程优化"}},[l("a",{staticClass:"header-anchor",attrs:{href:"#交互过程优化"}},[v._v("#")]),v._v(" 交互过程优化")]),v._v(" "),l("h3",{attrs:{id:"网络请求"}},[l("a",{staticClass:"header-anchor",attrs:{href:"#网络请求"}},[v._v("#")]),v._v(" 网络请求")]),v._v(" "),l("ul",[l("li",[l("p",[v._v("请求前置")])]),v._v(" "),l("li",[l("p",[v._v("请求合并")])]),v._v(" "),l("li",[l("p",[v._v("请求过滤(防重复)")]),v._v(" "),l("ul",[l("li",[v._v("cancelToken")])])]),v._v(" "),l("li",[l("p",[v._v("请求资源缓存")]),v._v(" "),l("ul",[l("li",[v._v("react-query")]),v._v(" "),l("li",[v._v("swr")])])])]),v._v(" "),l("h3",{attrs:{id:"编码优化"}},[l("a",{staticClass:"header-anchor",attrs:{href:"#编码优化"}},[v._v("#")]),v._v(" 编码优化")]),v._v(" "),l("ul",[l("li",[v._v("利用算法")]),v._v(" "),l("li",[v._v("object.freeze")]),v._v(" "),l("li",[v._v("使用多线程Webworker")])]),v._v(" "),l("h3",{attrs:{id:"组件加载"}},[l("a",{staticClass:"header-anchor",attrs:{href:"#组件加载"}},[v._v("#")]),v._v(" 组件加载")]),v._v(" "),l("ul",[l("li",[v._v("组件懒加载\n"),l("ul",[l("li",[v._v("长列表\n"),l("ul",[l("li",[v._v("分页")]),v._v(" "),l("li",[v._v("虚拟滚动")])])]),v._v(" "),l("li",[v._v("图片懒加载\n"),l("ul",[l("li",[v._v("进入视口后加载:使用IntersectionObserver API")]),v._v(" "),l("li",[v._v("使用新的属性: loading=lazy")])])])])]),v._v(" "),l("li",[v._v("组件预加载")])]),v._v(" "),l("h3",{attrs:{id:"解决卡顿"}},[l("a",{staticClass:"header-anchor",attrs:{href:"#解决卡顿"}},[v._v("#")]),v._v(" 解决卡顿")]),v._v(" "),l("p",[v._v("FPS 在 60 以上，单帧渲染耗时")]),v._v(" "),l("p",[v._v("fps_compatibility 表示兼容性方面的处理")]),v._v(" "),l("ul",[l("li",[l("p",[v._v("使用requestanimationframe/requestIdleCallback")])]),v._v(" "),l("li",[l("p",[v._v("使用Webworker")])]),v._v(" "),l("li",[l("p",[v._v("降低卡顿：")])])]),v._v(" "),l("ol",[l("li",[l("p",[v._v("数据相关，找后端协调")])]),v._v(" "),l("li",[l("p",[v._v("主线程和合成线程调度问题；合成线程主要用于绘制\n利用 transform")])]),v._v(" "),l("li",[l("p",[v._v("空间换时间，时间换空间 ，复杂任务拆分为多个任务")])]),v._v(" "),l("li",[l("p",[v._v("在对 dom 元素增删对过程中最好在 DocumentFragment 上操作，而不是直接在 Dom 上操作")])])]),v._v(" "),l("h2",{attrs:{id:"渲染-2"}},[l("a",{staticClass:"header-anchor",attrs:{href:"#渲染-2"}},[v._v("#")]),v._v(" 渲染")]),v._v(" "),l("ul",[l("li",[l("p",[v._v("preload/prefetch")])]),v._v(" "),l("li",[l("p",[v._v("prerender-spa-plugin 预渲染")])]),v._v(" "),l("li",[l("p",[v._v("defer/async")])]),v._v(" "),l("li",[l("p",[v._v("防抖/节流")])]),v._v(" "),l("li",[l("p",[v._v("重绘/回流")])])]),v._v(" "),l("h2",{attrs:{id:"构建过程优化"}},[l("a",{staticClass:"header-anchor",attrs:{href:"#构建过程优化"}},[v._v("#")]),v._v(" 构建过程优化")]),v._v(" "),l("h3",{attrs:{id:"优化打包体积"}},[l("a",{staticClass:"header-anchor",attrs:{href:"#优化打包体积"}},[v._v("#")]),v._v(" 优化打包体积")]),v._v(" "),l("ul",[l("li",[l("p",[v._v("压缩")]),v._v(" "),l("ul",[l("li",[v._v("gzip压缩/brotli")]),v._v(" "),l("li",[v._v("js （terserPlugin）")]),v._v(" "),l("li",[v._v("html(html-webpack-plugin)")]),v._v(" "),l("li",[v._v("css (optimizeCssAssetsWebpackPlugin)")]),v._v(" "),l("li",[v._v("图片压缩（image-webpack-loader）")])])]),v._v(" "),l("li",[l("p",[v._v("剔除无用代码")]),v._v(" "),l("ul",[l("li",[v._v("js Tree Shaking: 无用导出将在生产环境进行删除")]),v._v(" "),l("li",[v._v("css (MinicssExtractPlugin,PurgessWebpackPlugin)")])])]),v._v(" "),l("li",[l("p",[v._v("更小的图片体积")]),v._v(" "),l("ul",[l("li",[v._v("webp")]),v._v(" "),l("li",[v._v("avif")]),v._v(" "),l("li",[v._v("更合适的尺寸: 当页面仅需显示 100px/100px 大小图片时，对图片进行压缩到 100px/100px")]),v._v(" "),l("li",[v._v("更合适的压缩: 可对前端图片进行适当压缩，如通过 sharp 等")])])]),v._v(" "),l("li",[l("p",[v._v("代码分割")]),v._v(" "),l("ul",[l("li",[v._v("路由懒加载（ import）")]),v._v(" "),l("li",[v._v("bundle spliting")]),v._v(" "),l("li",[v._v("入口点分割（多页应用）")]),v._v(" "),l("li",[v._v("提取公共代码")]),v._v(" "),l("li",[v._v("使用CDN包")])])]),v._v(" "),l("li",[l("p",[v._v("借用WASM其他语言开发工具链")])])]),v._v(" "),l("h3",{attrs:{id:"优化打包速度"}},[l("a",{staticClass:"header-anchor",attrs:{href:"#优化打包速度"}},[v._v("#")]),v._v(" 优化打包速度")]),v._v(" "),l("ul",[l("li",[l("p",[v._v("缩小打包范围")]),v._v(" "),l("ul",[l("li",[v._v("exclude/include")]),v._v(" "),l("li",[v._v("alias")]),v._v(" "),l("li",[v._v("extensions")]),v._v(" "),l("li",[v._v("resolverLoader")]),v._v(" "),l("li",[v._v("modules")])])]),v._v(" "),l("li",[l("p",[v._v("利用缓存")]),v._v(" "),l("ul",[l("li",[v._v("开启babel-loader缓存")]),v._v(" "),l("li",[v._v("cache-loader")]),v._v(" "),l("li",[v._v("hard-source-webpack-plugin")])])]),v._v(" "),l("li",[l("p",[v._v("编译提速")]),v._v(" "),l("ul",[l("li",[v._v("browserlist/babel: 及时更新 browserlist，将会产生更小的垫片体积")]),v._v(" "),l("li",[v._v("Esbuild（go）")]),v._v(" "),l("li",[v._v("SWC（rust）")])])]),v._v(" "),l("li",[l("p",[v._v("开启多进程")]),v._v(" "),l("ul",[l("li",[v._v("thread-loader")]),v._v(" "),l("li",[v._v("happyPack（弃用）")])])]),v._v(" "),l("li",[l("p",[v._v("预编译")]),v._v(" "),l("ul",[l("li",[v._v("DllPlugin")]),v._v(" "),l("li",[v._v("DllReferencePlugin")])])])]),v._v(" "),l("h2",{attrs:{id:"推荐阅读"}},[l("a",{staticClass:"header-anchor",attrs:{href:"#推荐阅读"}},[v._v("#")]),v._v(" 推荐阅读")]),v._v(" "),l("p",[l("a",{attrs:{href:"https://mp.weixin.qq.com/s/J0bnhtr24q7f8Jn7eNs7Jg",target:"_blank",rel:"noopener noreferrer"}},[v._v("写在 2022 的前端性能优化指南"),l("OutboundLink")],1)]),v._v(" "),l("p",[l("a",{attrs:{href:"https://juejin.cn/post/7052918009555320839#heading-1",target:"_blank",rel:"noopener noreferrer"}},[v._v("最全的前端性能定位总结"),l("OutboundLink")],1)])])}),[],!1,null,null,null);_.default=i.exports}}]);