(window.webpackJsonp=window.webpackJsonp||[]).push([[51],{465:function(t,s,a){"use strict";a.r(s);var n=a(16),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"requestidlecallback-æ˜¯ä»€ä¹ˆ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#requestidlecallback-æ˜¯ä»€ä¹ˆ"}},[t._v("#")]),t._v(" requestIdleCallback æ˜¯ä»€ä¹ˆï¼Ÿ")]),t._v(" "),a("p",[t._v("requestIdleCallback æ˜¯ä¸€ä¸ªè¿˜åœ¨å®éªŒä¸­çš„ api,å¯ä»¥è®©æˆ‘ä»¬åœ¨æµè§ˆå™¨ç©ºé—²çš„æ—¶å€™åšä¸€äº›äº‹æƒ…")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/038ea55906694169b3fed2760ba60e7c~tplv-k3u1fbpfcp-watermark.awebp",alt:""}})]),t._v(" "),a("p",[t._v("RequestIdleCallback ç®€å•çš„è¯´ï¼Œåˆ¤æ–­ä¸€å¸§æœ‰ç©ºé—²æ—¶é—´ï¼Œåˆ™å»æ‰§è¡ŒæŸä¸ªä»»åŠ¡ã€‚\nç›®çš„æ˜¯ä¸ºäº†è§£å†³å½“ä»»åŠ¡éœ€è¦é•¿æ—¶é—´å ç”¨ä¸»è¿›ç¨‹ï¼Œå¯¼è‡´æ›´é«˜ä¼˜å…ˆçº§ä»»åŠ¡(å¦‚åŠ¨ç”»æˆ–äº‹ä»¶ä»»åŠ¡)ï¼Œæ— æ³•åŠæ—¶å“åº”ï¼Œè€Œå¸¦æ¥çš„é¡µé¢ä¸¢å¸§(å¡æ­»)æƒ…å†µã€‚\næ•…RequestIdleCallback å®šä½å¤„ç†çš„æ˜¯: "),a("strong",[t._v("ä¸é‡è¦ä¸”ä¸ç´§æ€¥çš„ä»»åŠ¡")]),t._v("ã€‚")]),t._v(" "),a("h3",{attrs:{id:"åŸºæœ¬è¯­æ³•"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#åŸºæœ¬è¯­æ³•"}},[t._v("#")]),t._v(" åŸºæœ¬è¯­æ³•")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" handle "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("requestIdleCallback")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("callback"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" options"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("ul",[a("li",[a("p",[t._v("è¿”å›å€¼\nä¸€ä¸ªIDï¼Œå¯ä»¥æŠŠå®ƒä¼ å…¥ Window.cancelIdleCallback() æ–¹æ³•æ¥ç»“æŸå›è°ƒã€‚")])]),t._v(" "),a("li",[a("p",[t._v("callback\nä¸€ä¸ªåœ¨äº‹ä»¶å¾ªç¯ç©ºé—²æ—¶å³å°†è¢«è°ƒç”¨çš„å‡½æ•°çš„å¼•ç”¨ã€‚å‡½æ•°ä¼šæ¥æ”¶åˆ°ä¸€ä¸ªåä¸º IdleDeadline çš„å‚æ•°ï¼Œè¿™ä¸ªå‚æ•°å¯ä»¥è·å–å½“å‰ç©ºé—²æ—¶é—´ä»¥åŠå›è°ƒæ˜¯å¦åœ¨è¶…æ—¶æ—¶é—´å‰å·²ç»æ‰§è¡Œçš„çŠ¶æ€ã€‚")])]),t._v(" "),a("li",[a("p",[t._v("options å¯é€‰\nåŒ…æ‹¬å¯é€‰çš„é…ç½®å‚æ•°ã€‚å…·æœ‰å¦‚ä¸‹å±æ€§ï¼š\ntimeoutï¼š å¦‚æœæŒ‡å®šäº†timeoutï¼Œå¹¶ä¸”æœ‰ä¸€ä¸ªæ­£å€¼ï¼Œè€Œå›è°ƒåœ¨timeoutæ¯«ç§’è¿‡åè¿˜æ²¡æœ‰è¢«è°ƒç”¨ï¼Œé‚£ä¹ˆå›è°ƒä»»åŠ¡å°†æ”¾å…¥äº‹ä»¶å¾ªç¯ä¸­æ’é˜Ÿï¼Œå³ä½¿è¿™æ ·åšæœ‰å¯èƒ½å¯¹æ€§èƒ½äº§ç”Ÿè´Ÿé¢å½±å“ã€‚")])])]),t._v(" "),a("h3",{attrs:{id:"åŸºæœ¬åº”ç”¨"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#åŸºæœ¬åº”ç”¨"}},[t._v("#")]),t._v(" åŸºæœ¬åº”ç”¨")]),t._v(" "),a("div",{staticClass:"language-ts line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-ts"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Deadline")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("timeRemaining")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("number")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å½“å‰å‰©ä½™çš„å¯ç”¨æ—¶é—´ã€‚å³è¯¥å¸§å‰©ä½™æ—¶é—´ã€‚")]),t._v("\n  didTimeout"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("boolean")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æ˜¯å¦è¶…æ—¶ã€‚")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("work")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("deadline"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("Deadline"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// deadline ä¸Šé¢æœ‰ä¸€ä¸ª timeRemaining() æ–¹æ³•ï¼Œèƒ½å¤Ÿè·å–å½“å‰æµè§ˆå™¨çš„å‰©ä½™ç©ºé—²æ—¶é—´ï¼Œ")]),t._v("\nå•ä½ msï¼›æœ‰ä¸€ä¸ªå±æ€§ didTimeoutï¼Œè¡¨ç¤ºæ˜¯å¦è¶…æ—¶\n  "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("console")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("å½“å‰å¸§å‰©ä½™æ—¶é—´: ")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("deadline"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("timeRemaining")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("deadline"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("timeRemaining")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" deadline"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("didTimeout"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n     "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// èµ°åˆ°è¿™é‡Œï¼Œè¯´æ˜æ—¶é—´æœ‰ä½™ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨è¿™é‡Œå†™è‡ªå·±çš„ä»£ç é€»è¾‘")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// èµ°åˆ°è¿™é‡Œï¼Œè¯´æ˜æ—¶é—´ä¸å¤Ÿäº†ï¼Œå°±è®©å‡ºæ§åˆ¶æƒç»™ä¸»çº¿ç¨‹ï¼Œä¸‹æ¬¡ç©ºé—²æ—¶ç»§ç»­è°ƒç”¨")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("requestIdleCallback")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("work"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("requestIdleCallback")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("work"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" timeout"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// è¿™è¾¹å¯ä»¥ä¼ ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼ˆå¿…ä¼ ï¼‰å’Œå‚æ•°ï¼ˆç›®å‰å°±åªæœ‰è¶…æ—¶è¿™ä¸€ä¸ªå‚æ•°ï¼‰")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br")])]),a("h3",{attrs:{id:"ç¼ºç‚¹"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ç¼ºç‚¹"}},[t._v("#")]),t._v(" ç¼ºç‚¹")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("è¿™æ˜¯ä¸€ä¸ªå®éªŒä¸­çš„åŠŸèƒ½\næ­¤åŠŸèƒ½æŸäº›æµè§ˆå™¨å°šåœ¨å¼€å‘ä¸­ï¼Œè¯·å‚è€ƒæµè§ˆå™¨å…¼å®¹æ€§è¡¨æ ¼ä»¥å¾—åˆ°åœ¨ä¸åŒæµè§ˆå™¨ä¸­é€‚åˆä½¿ç”¨çš„å‰ç¼€ã€‚ç”±äºè¯¥åŠŸèƒ½å¯¹åº”çš„æ ‡å‡†æ–‡æ¡£å¯èƒ½è¢«é‡æ–°ä¿®è®¢ï¼Œæ‰€ä»¥åœ¨æœªæ¥ç‰ˆæœ¬çš„æµè§ˆå™¨ä¸­è¯¥åŠŸèƒ½çš„è¯­æ³•å’Œè¡Œä¸ºå¯èƒ½éšä¹‹æ”¹å˜ã€‚")])]),t._v(" "),a("li",[a("p",[a("a",{attrs:{href:"https://github.com/Linjiayu6/FE-RequestIdleCallback-demo",target:"_blank",rel:"noopener noreferrer"}},[t._v("å®éªŒè¿‡ç¨‹"),a("OutboundLink")],1),t._v("\nå®éªŒç»“è®º: requestIdleCallback FPSåªæœ‰20msï¼Œæ­£å¸¸æƒ…å†µä¸‹æ¸²æŸ“ä¸€å¸§æ—¶é•¿æ§åˆ¶åœ¨16.67ms (1s / 60 = 16.67ms)ã€‚è¯¥æ—¶é—´æ˜¯é«˜äºé¡µé¢æµç•…çš„è¯‰æ±‚ã€‚")])]),t._v(" "),a("li",[a("p",[t._v("æœ‰äººè®¤ä¸º\nRequestIdleCallback ä¸é‡è¦ä¸”ä¸ç´§æ€¥çš„å®šä½ã€‚å› ä¸ºReactæ¸²æŸ“å†…å®¹ï¼Œå¹¶éæ˜¯ä¸é‡è¦ä¸”ä¸ç´§æ€¥ã€‚ä¸ä»…è¯¥apiå…¼å®¹ä¸€èˆ¬ï¼Œå¸§æ¸²æŸ“èƒ½åŠ›ä¸€èˆ¬ï¼Œä¹Ÿä¸å¤ªç¬¦åˆæ¸²æŸ“è¯‰æ±‚ï¼Œæ•…React å›¢é˜Ÿè‡ªè¡Œå®ç°")])])]),t._v(" "),a("h2",{attrs:{id:"requestidlecallback-å’Œ-requestanimationframe-çš„åŒºåˆ«"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#requestidlecallback-å’Œ-requestanimationframe-çš„åŒºåˆ«"}},[t._v("#")]),t._v(" requestIdleCallback å’Œ requestAnimationFrame çš„åŒºåˆ«")]),t._v(" "),a("p",[t._v("requestAnimationFrame çš„å›è°ƒä¼šåœ¨æ¯ä¸€å¸§ç¡®è®¤æ‰§è¡Œ, å±äºé«˜ä¼˜å…ˆçº§ä»»åŠ¡. è€Œ requestIdleCallback çš„å›è°ƒä¸ä¸€å®š, å±äºä½ä¼˜å…ˆçº§ä»»åŠ¡.\næˆ‘ä»¬çœ‹åˆ°çš„é¡µé¢æ˜¯æµè§ˆå™¨ä¸€å¸§ä¸€å¸§ç»˜åˆ¶å‡ºæ¥çš„, é€šå¸¸ FPS åœ¨ 60 çš„æ—¶å€™æ˜¯æ¯”è¾ƒæµç•…çš„, è€Œ FPS æ¯”è¾ƒä½çš„æ—¶å€™å°±ä¼šæ„Ÿè§‰åˆ°å¡é¡¿.\né‚£ä¹ˆåœ¨æ¯ä¸€å¸§é‡Œæµè§ˆå™¨ä¼šåšå“ªäº›äº‹æƒ…å‘¢, å¦‚ä¸‹å›¾æ‰€ç¤º:")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c7885e81d59849868445d3c0b37d655d~tplv-k3u1fbpfcp-watermark.awebp?",alt:""}})]),t._v(" "),a("p",[t._v("å›¾ä¸­ä¸€å¸§åŒ…æ‹¬äº†ç”¨æˆ·çš„äº¤äº’, JavaScript è„šæœ¬æ‰§è¡Œ; ä»¥åŠ ***requestAnimationFrame(rAF)***çš„è°ƒç”¨, å¸ƒå±€è®¡ç®—ä»¥åŠé¡µé¢é‡ç»˜ç­‰.\nå‡å¦‚æŸä¸€å¸§é‡Œæ‰§è¡Œçš„ä»»åŠ¡ä¸å¤š, åœ¨ä¸åˆ° 16.66ms(1000/60)å†…å°±å®Œæˆäº†ä¸Šè¿°ä»»åŠ¡, é‚£ä¹ˆè¿™ä¸€å¸§å°±ä¼šæœ‰ä¸€å®šç©ºé—²æ—¶é—´æ¥æ‰§è¡Œ "),a("em",[a("strong",[t._v("requestIdleCallback")])]),t._v(" çš„å›è°ƒ, å¦‚å›¾æ‰€ç¤º:")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6c897de9b44c45faa24fced21b38c3a6~tplv-k3u1fbpfcp-watermark.awebp?",alt:""}})]),t._v(" "),a("p",[t._v("å½“ç¨‹åºæ ˆä¸ºç©ºé¡µé¢æ— éœ€æ›´æ–°çš„æ—¶å€™, æµè§ˆå™¨å…¶å®æ˜¯å¤„äºç©ºé—²çŠ¶æ€, è¿™æ—¶å€™ç•™ç»™requestIdleCallbackæ‰§è¡Œçš„æ—¶é—´å°±å¯ä»¥é€‚å½“æ‹‰é•¿, æœ€é•¿è¾¾åˆ° 50ms, ä»¥é˜²å‡ºç°ä¸å¯é¢„æµ‹çš„ä»»åŠ¡(å¦‚ç”¨æˆ·è¾“å…¥), é¿å…æ— æ³•åŠæ—¶å“åº”ä½¿ç”¨æˆ·æ„ŸçŸ¥åˆ°å»¶è¿Ÿ.\n"),a("img",{attrs:{src:"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/171dab554daa414390ee6a72f2fd6446~tplv-k3u1fbpfcp-watermark.awebp?",alt:""}})]),t._v(" "),a("p",[t._v("ç”±äºrequestIdleCallbackåˆ©ç”¨çš„æ˜¯å¸§çš„ç©ºé—²æ—¶é—´, æ‰€ä»¥æœ‰å¯èƒ½å‡ºç°æµè§ˆå™¨ä¸€ç›´å¤„äºç¹å¿™çŠ¶æ€, å¯¼è‡´å›è°ƒä¸€ç›´æ— æ³•æ‰§è¡Œ, é‚£è¿™æ—¶å€™å°±éœ€è¦åœ¨è°ƒç”¨requestIdleCallbackçš„æ—¶å€™ä¼ é€’ç¬¬äºŒä¸ªé…ç½®å‚æ•°timeoutäº†.")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("requestIdleCallback")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("myNonEssentialWork"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("timeout")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2000")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("myNonEssentialWork")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("deadline")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å½“å›è°ƒå‡½æ•°æ˜¯ç”±äºè¶…æ—¶æ‰å¾—ä»¥æ‰§è¡Œçš„è¯ï¼Œdeadline.didTimeoutä¸ºtrue")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("deadline"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("timeRemaining")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" deadline"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("didTimeout"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v("\n    tasks"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("doWorkIfNeeded")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("tasks"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("requestIdleCallback")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("myNonEssentialWork"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br")])]),a("p",[t._v("å¦‚æœæ˜¯å› ä¸ºtimeoutå›è°ƒæ‰å¾—ä»¥æ‰§è¡Œçš„è¯, ç”¨æˆ·å°±æœ‰å¯èƒ½æ„Ÿå—åˆ°å¡é¡¿, å› ä¸ºä¸€å¸§çš„æ—¶é—´å·²ç»è¶…è¿‡ 16ms äº†.")]),t._v(" "),a("h2",{attrs:{id:"requestidlecallback-åœ¨ç©ºé—²æ—¶é—´é‡Œæœ‰å“ªäº›èƒ½åšå’Œä¸èƒ½åš"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#requestidlecallback-åœ¨ç©ºé—²æ—¶é—´é‡Œæœ‰å“ªäº›èƒ½åšå’Œä¸èƒ½åš"}},[t._v("#")]),t._v(" requestIdleCallback åœ¨ç©ºé—²æ—¶é—´é‡Œæœ‰å“ªäº›èƒ½åšå’Œä¸èƒ½åš")]),t._v(" "),a("h3",{attrs:{id:"ä¸è¦åšä»€ä¹ˆ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ä¸è¦åšä»€ä¹ˆ"}},[t._v("#")]),t._v(" ä¸è¦åšä»€ä¹ˆ")]),t._v(" "),a("ol",[a("li",[t._v("ä¸è¦åœ¨requestIdleCallback é‡Œæ‰§è¡Œä¿®æ”¹DOMæ“ä½œ")])]),t._v(" "),a("p",[t._v("å¼ºçƒˆå»ºè®®ä¸è¦åœ¨requestIdleCallbacké‡Œé¢æ‰§è¡Œä¿®æ”¹ DOM çš„æ“ä½œ.\nä»ä¸Šé¢ä¸€å¸§çš„æ„æˆä¸­å¯ä»¥çœ‹åˆ°, requestIdleCallbackå›è°ƒæ‰§è¡Œä¹‹å‰, æ ·å¼å˜æ›´ä»¥åŠå¸ƒå±€è®¡ç®—ç­‰éƒ½å·²ç»å®Œæˆ. å¦‚æœåœ¨callbackä¸­ä¿®æ”¹ DOM çš„è¯, ä¹‹å‰æ‰€ä½œçš„å¸ƒå±€è®¡ç®—éƒ½ä¼šå¤±æ•ˆ. å¹¶ä¸”å¦‚æœä¸‹ä¸€å¸§é‡Œæœ‰è·å–å¸ƒå±€ç›¸å…³çš„æ“ä½œ, æµè§ˆå™¨å°±éœ€è¦å¼ºåˆ¶è¿›è¡Œé‡æ’, æå¤§çš„å½±å“æ€§èƒ½. å¦å¤–ç”±äºä¿®æ”¹ DOM çš„æ—¶é—´æ˜¯ä¸å¯é¢„æµ‹çš„, å› æ­¤å®¹æ˜“è¶…è¿‡å½“å‰å¸§ç©ºé—²çš„é˜ˆå€¼.")]),t._v(" "),a("p",[t._v("æ¨èçš„åšæ³•æ˜¯åœ¨ ***requestAnimationFrame***é‡Œé¢åš DOM çš„ä¿®æ”¹.")]),t._v(" "),a("ol",{attrs:{start:"2"}},[a("li",[t._v("é™¤äº†ä¸æ¨è DOM ä¿®æ”¹æ“ä½œå¤–, **Promiseçš„resolve(reject)**æ“ä½œä¹Ÿä¸å»ºè®®æ”¾åœ¨é‡Œé¢, å› ä¸ºPromiseçš„å›è°ƒä¼šåœ¨ idle çš„å›è°ƒæ‰§è¡Œå®Œæˆåç«‹å³æ‰§è¡Œ, æ‹‰é•¿å½“å‰å¸§çš„è€—æ—¶. promise çš„å›è°ƒå±äºä¼˜å…ˆçº§è¾ƒé«˜çš„å¾®ä»»åŠ¡ï¼Œæ‰€ä»¥ä¼šåœ¨ requestIdleCallback å›è°ƒç»“æŸåç«‹å³æ‰§è¡Œï¼Œå¯èƒ½ä¼šç»™è¿™ä¸€å¸§å¸¦æ¥è¶…æ—¶çš„é£é™©ã€‚")])]),t._v(" "),a("h3",{attrs:{id:"èƒ½åšä»€ä¹ˆ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#èƒ½åšä»€ä¹ˆ"}},[t._v("#")]),t._v(" èƒ½åšä»€ä¹ˆ")]),t._v(" "),a("ol",[a("li",[t._v("æ•°æ®çš„åˆ†æå’Œä¸ŠæŠ¥")])]),t._v(" "),a("ul",[a("li",[t._v("åœ¨ç”¨æˆ·æœ‰æ“ä½œè¡Œä¸ºæ—¶ï¼ˆå¦‚ç‚¹å‡»æŒ‰é’®ã€æ»šåŠ¨é¡µé¢ï¼‰è¿›è¡Œæ•°æ®åˆ†æå¹¶ä¸ŠæŠ¥ã€‚")]),t._v(" "),a("li",[t._v("å¤„ç†æ•°æ®æ—¶å¾€å¾€ä¼šè°ƒç”¨ JSON.stringify ï¼Œå¦‚æœæ•°æ®é‡è¾ƒå¤§ï¼Œå¯èƒ½ä¼šæœ‰æ€§èƒ½é—®é¢˜ã€‚")])]),t._v(" "),a("p",[t._v("æ­¤æ—¶æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ requestIdleCallback è°ƒåº¦ä¸ŠæŠ¥æ—¶æœºï¼Œé¿å…ä¸ŠæŠ¥é˜»å¡é¡µé¢æ¸²æŸ“ï¼Œä¸‹é¢æ˜¯ç®€å•çš„ä»£ç ç¤ºä¾‹ï¼ˆå¯è·³è¿‡ï¼‰")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" queues "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" btns "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" btns"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("forEach")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("btn")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    btn"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("addEventListener")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'click'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("e")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// do something")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("pushQueue")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'click'")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("schedule")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ç­‰åˆ°ç©ºé—²å†å¤„ç†")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("schedule")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("requestIdleCallback")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("deadline")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("deadline"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("timeRemaining")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n              "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" data "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" queues"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("pop")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n              "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// è¿™é‡Œå°±å¯ä»¥å¤„ç†æ•°æ®ã€ä¸Šä¼ æ•°æ®")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("queues"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("schedule")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br")])]),a("ol",{attrs:{start:"2"}},[a("li",[t._v("é¢„åŠ è½½")])]),t._v(" "),a("p",[t._v("åœ¨ç©ºé—²çš„æ—¶å€™åŠ è½½äº›ä¸œè¥¿ï¼Œå¯ä»¥çœ‹çœ‹ "),a("a",{attrs:{href:"https://github.com/umijs/qiankun/blob/master/src/prefetch.ts",target:"_blank",rel:"noopener noreferrer"}},[t._v("qiankun"),a("OutboundLink")],1),t._v(" çš„ä¾‹å­ï¼Œç”¨æ¥é¢„åŠ è½½ js å’Œ css")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("prefetch")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("entry")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Entry"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" opts"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" ImportEntryOpts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("navigator"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("onLine "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" isSlowNetwork"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Don't prefetch if in a slow network or offline")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("requestIdleCallback")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" getExternalScripts"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" getExternalStyleSheets "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("importEntry")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("entry"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" opts"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("requestIdleCallback")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("getExternalStyleSheets"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("requestIdleCallback")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("getExternalScripts"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br")])]),a("ol",{attrs:{start:"3"}},[a("li",[t._v("æ£€æµ‹å¡é¡¿")])]),t._v(" "),a("ul",[a("li",[t._v("ä¸€èˆ¬æ£€æµ‹çš„å¡é¡¿æ–¹æ³•æœ‰ä¸¤ç§ï¼š\n"),a("ul",[a("li",[t._v("æµ‹é‡ fps å€¼ï¼Œå¦‚æœè¿ç»­å‡ºç°å‡ ä¸ª fps å€¼ â‰¤ é˜ˆå€¼ï¼Œåˆ™è®¤ä¸ºæ˜¯å¡é¡¿")]),t._v(" "),a("li",[t._v("å¼€è¾Ÿä¸€ä¸ª worker çº¿ç¨‹å’Œä¸»çº¿ç¨‹ä¹‹é—´æ¥ä¸ªå¿ƒè·³æ£€æµ‹ï¼Œä¸€æ®µæ—¶é—´å†…æ²¡å“åº”ï¼Œåˆ™è®¤ä¸ºæ˜¯å¡é¡¿")])])])]),t._v(" "),a("p",[t._v("å›è¿‡å¤´æ¥ï¼Œå¦‚æœ "),a("em",[a("strong",[t._v("requestIdleCallback")])]),t._v(" é•¿æ—¶é—´å†…æ²¡èƒ½å¾—åˆ°æ‰§è¡Œï¼Œè¯´æ˜ä¸€ç›´æ²¡æœ‰ç©ºé—²æ—¶é—´ï¼Œå¾ˆæœ‰å¯èƒ½å°±æ˜¯å‘ç”Ÿäº†å¡é¡¿ï¼Œä»è€Œå¯ä»¥æ‰“ç‚¹ä¸ŠæŠ¥ã€‚å®ƒæ¯”è¾ƒé€‚ç”¨äºè¡Œä¸ºå¡é¡¿ï¼Œä¸¾ä¸ªä¾‹å­ï¼šç‚¹å‡»æŸä¸ªæŒ‰é’®å¹¶åŒæ—¶æ·»åŠ æˆ‘ä»¬çš„ "),a("em",[a("strong",[t._v("requestIdleCallback")])]),t._v(" å›è°ƒï¼Œå¦‚æœç‚¹å‡»åçš„ä¸€æ®µæ—¶é—´å†…è¿™ä¸ªå›è°ƒæ²¡æœ‰å¾—åˆ°æ‰§è¡Œï¼Œå¾ˆå¤§æ¦‚ç‡æ˜¯è¿™ä¸ªç‚¹å‡»æ“ä½œé€ æˆäº†å¡é¡¿ã€‚")]),t._v(" "),a("ol",{attrs:{start:"4"}},[a("li",[t._v("æ‹†åˆ†è€—æ—¶ä»»åŠ¡")])]),t._v(" "),a("p",[t._v("è¿™ä¸ªæ€æƒ³åœ¨ "),a("a",{attrs:{href:"https://github.com/facebook/react/blob/1fb18e22ae66fdb1dc127347e169e73948778e5a/packages/scheduler/src/Scheduler.js",target:"_blank",rel:"noopener noreferrer"}},[t._v("React ä¸­çš„è°ƒåº¦å™¨ Scheduler"),a("OutboundLink")],1),t._v("é‡Œé¢å±•ç°çš„æ·‹æ¼“å°½è‡´ï¼Œè™½ç„¶ React è‡ªå·±å®ç°äº†ä¸€å¥—è°ƒåº¦é€»è¾‘(å…¼å®¹æ€§ã€ç¨³å®šæ€§å’Œä¼˜å…ˆçº§ç­‰åŸå› )ï¼Œä¸è¿‡ä¸å¦¨ç¢æˆ‘ä»¬ç†è§£ã€‚\nç®€å•æ¥è¯´ React æŠŠ diff çš„è¿‡ç¨‹ä»æ—©å‰çš„é€’å½’å˜æˆäº†ç°åœ¨çš„è¿­ä»£ï¼Œå¯¹ä¸¤ä¸ªå¤§å¯¹è±¡è¿›è¡Œé€’å½’ diff å°±æ˜¯ä¸ªè€—æ—¶çš„ä»»åŠ¡ï¼Œå¦‚æœèƒ½å¤Ÿæ‹†è§£æˆå°ä»»åŠ¡ï¼Œé‚£è¯¥æœ‰å¤šå¥½ã€‚ä½†æ˜¯é€’å½’åˆä¸èƒ½ä¸­é€”ç»ˆæ­¢ï¼Œæ‰€ä»¥ React é‡‡ç”¨äº† fiber è¿™ç§æ•°æ®ç»“æ„ï¼ŒæŠŠé€’å½’å˜æˆäº†é“¾è¡¨è¿­ä»£ï¼Œè¿­ä»£å°±å¯ä»¥ä¸­é€”åœæ­¢ï¼Œæˆ‘ä»¬å°±ä¸ç”¨ä¸€æ¬¡æ€§ diff å®Œã€‚\npsï¼šä¸æ‡‚é“¾è¡¨çš„åŒå­¦å°±ç®€å•ç†è§£æˆæ˜¯æ•°ç»„å§ï¼Œä½ æƒ³æƒ³å¦‚æœæˆ‘ä»¬è¦æŠŠæ•°ç»„è¿›è¡Œéå†ï¼Œæˆ‘ä»¬å¯ä»¥ä¸€æ¬¡æ€§æ‰§è¡Œå®Œï¼Œä½†æ˜¯æˆ‘ä»¬ä¹Ÿå¯ä»¥æ‹†æˆå‡ æ¬¡æ‰§è¡Œå®Œï¼Œåªè¦æˆ‘ä»¬è®°å½•ä¸ª indexï¼Œä¸‹æ¬¡å›æ¥ç»§ç»­æ‰§è¡Œä»£ç çš„æ—¶å€™å°±ä» index å¼€å§‹éå†å°±è¡Œï¼Œä¸çŸ¥é“å¤§å®¶ get åˆ°æœ¨æœ‰ã€‚")]),t._v(" "),a("h2",{attrs:{id:"æ¨¡æ‹Ÿå®ç°requestidlecallback"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æ¨¡æ‹Ÿå®ç°requestidlecallback"}},[t._v("#")]),t._v(" æ¨¡æ‹Ÿå®ç°requestIdleCallback")]),t._v(" "),a("h3",{attrs:{id:"ç”¨-settimeout-å®ç°"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ç”¨-settimeout-å®ç°"}},[t._v("#")]),t._v(" ç”¨ setTimeout å®ç°")]),t._v(" "),a("p",[t._v("é¦–é€‰å¤§å®¶è¦çŸ¥é“ä¸€ä¸ªå‰æï¼Œä¸ºä»€ä¹ˆèƒ½å¤Ÿ setTimeout æ¥æ¨¡æ‹Ÿï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆç®€å•çœ‹ä¸‹ä¸‹é¢è¿™ä¸¤è¡Œä»£ç ï¼š")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æŸç§ç¨‹åº¦ä¸ŠåŠŸèƒ½ç›¸ä¼¼ï¼Œå†™æ³•ä¹Ÿç›¸ä¼¼")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("requestIdleCallback")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br")])]),a("p",[t._v("äº†è§£è¿‡ setTimeout çš„åŒå­¦åº”è¯¥çŸ¥é“è¿™ä¸ªä¸œè¥¿å®ƒä¸å‡†ï¼Œä¸Šé¢é‚£æ ·å†™å¹¶ä¸æ˜¯ç«‹åˆ»æ‰§è¡Œçš„æ„æ€ï¼Œè€Œæ˜¯å°½å¯èƒ½å¿«çš„æ‰§è¡Œï¼Œå°±æ˜¯ç­‰å¾…ä¸»çº¿ç¨‹ä¸ºç©ºï¼Œå¾®ä»»åŠ¡ä¹Ÿæ‰§è¡Œå®Œäº†ï¼Œé‚£ä¹ˆå°±å¯ä»¥è½®åˆ° setTimeout æ‰§è¡Œäº†ï¼Œæ‰€ä»¥ setTimeout(fn) æŸç§ç¨‹åº¦ä¸Šè®²ä¹Ÿæœ‰ç©ºé—²çš„æ„æ€ï¼Œäº†è§£äº†è¿™ä¸ªç‚¹æˆ‘ä»¬å°±å¯ä»¥ç”¨å®ƒæ¥æ¨¡æ‹Ÿå•¦ï¼Œç›´æ¥çœ‹ä¸‹é¢çš„ä»£ç å³å¯ï¼Œå°±æ˜¯åœ¨ setTimeout é‡Œé¢å¤šäº†ä¸ªæ„é€ å‚æ•°çš„æ­¥éª¤ï¼š")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("requestIdleCallback")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("cb")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" start "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Date"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("now")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" deadline "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// è¿™è¾¹å°±æ˜¯ä¸ºäº†æ„é€ å‚æ•°")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("timeRemaining")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" Math"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("max")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("50")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Date"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("now")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" start"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å‰©ä½™æ—¶é—´æˆ‘ä»¬å†™æ­»åœ¨ 50ms å†…ï¼Œä¹Ÿå°±æ˜¯å‰é¢æåˆ°çš„ä¸Šé™å€¼ï¼Œå…¶å®ä½ ä¹Ÿå¯ä»¥å†™æˆ 40ã€30ã€16ã€10 ç­‰ğŸ˜‚")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("didTimeout")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å› ä¸ºæˆ‘ä»¬ä¸æ¨èä½¿ç”¨ timeout å‚æ•°ï¼Œæ‰€ä»¥è¿™é‡Œå°±ç›´æ¥å†™æ­» false")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cb")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("deadline"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br")])]),a("p",[t._v("è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªå¹¶ä¸æ˜¯ requestIdleCallback çš„ polyfill ï¼Œå› ä¸ºå®é™…ä¸Šå®ƒä»¬å¹¶ä¸ç›¸åŒã€‚setTimeout å¹¶ä¸ç®—æ˜¯çœŸæ­£çš„åˆ©ç”¨ç©ºé—²æ—¶é—´ï¼Œè€Œæ˜¯åœ¨æ¡ä»¶å…è®¸çš„æƒ…å†µä¸‹å°½å¯èƒ½å¿«çš„æ‰§è¡Œä½ çš„ä»£ç ã€‚ä¸Šé¢çš„ä»£ç å¹¶ä¸ä¼šåƒçœŸæ­£çš„ requestIdleCallback é‚£æ ·å°†è‡ªå·±é™åˆ¶åœ¨è¿™ä¸€å¸§çš„ç©ºé—²æ—¶é—´å†…ï¼Œä½†æ˜¯å®ƒè¾¾åˆ°äº†ä¸¤ä¸ªæ•ˆæœï¼Œä¸€ä¸ªæ˜¯å°†ä»»åŠ¡åˆ†æ®µï¼Œä¸€ä¸ªæ˜¯æ§åˆ¶æ¯æ¬¡æ‰§è¡Œçš„æ—¶é—´ä¸Šé™ã€‚ä¸€èˆ¬æ»¡è¶³è¿™ä¸¤ä¸ªæ¡ä»¶çš„å°±æ˜¯å®ä»»åŠ¡äº†ï¼Œæ‰€ä»¥é™¤äº† setTimout å¤–ï¼ŒpostMessage ä¹Ÿæ˜¯å¯ä»¥å®ç°çš„ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹çœ‹æ¨¡æ‹Ÿçš„å¦ä¸€ç§æ–¹æ³•")]),t._v(" "),a("h3",{attrs:{id:"ç”¨-requestanimationframe-messagechannel-å®ç°"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ç”¨-requestanimationframe-messagechannel-å®ç°"}},[t._v("#")]),t._v(" ç”¨ requestAnimationFrame + MessageChannel å®ç°")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" deadlineTime "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å½“å‰å¸§ç»“æŸæ—¶é—´")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" callback "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// éœ€è¦å›è°ƒçš„ä»»åŠ¡")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" channel "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MessageChannel")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// postMessage çš„ä¸€ç§ï¼Œè¯¥å¯¹è±¡å®ä¾‹æœ‰ä¸”åªæœ‰ä¸¤ä¸ªç«¯å£ï¼Œå¹¶ä¸”å¯ä»¥ç›¸äº’æ”¶å‘äº‹ä»¶ï¼Œå½“åšæ˜¯å‘å¸ƒè®¢é˜…å³å¯ã€‚")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" port1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" channel"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("port1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" port2 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" channel"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("port2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nport2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onmessage")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("timeRemaining")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" deadlineTime "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" performance"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("now")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("timeRemaining")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" callback"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" deadline "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" timeRemaining"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("didTimeout")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// åŒæ ·çš„è¿™é‡Œä¹Ÿæ˜¯æ„é€ ä¸ªå‚æ•°")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("callback")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("deadline"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nwindow"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("requestIdleCallback")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("cb")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("requestAnimationFrame")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("rafStartTime")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å¤§æ¦‚è¿‡æœŸæ—¶é—´ = é»˜è®¤è¿™æ˜¯ä¸€å¸§çš„å¼€å§‹æ—¶é—´ + ä¸€å¸§å¤§æ¦‚è€—æ—¶")]),t._v("\n        deadlineTime "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" rafStartTime "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),t._v("\n        callback "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" cb\n        port1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("postMessage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br")])]),a("p",[t._v("ä¸Šé¢è¿™ç§æ–¹å¼ä¼šæ¯” setTimeout ç¨å¥½ä¸€äº›ï¼Œå› ä¸º MessageChannel çš„æ‰§è¡Œåœ¨ setTimeout ä¹‹å‰ï¼Œå¹¶ä¸”æ²¡æœ‰ 4ms çš„æœ€å°å»¶æ—¶ã€‚\né‚£ä¸ºä»€ä¹ˆä¸ç”¨å¾®ä»»åŠ¡æ¨¡æ‹Ÿå‘¢ï¼Ÿå› ä¸ºå¦‚æœä½ ç”¨å¾®ä»»åŠ¡æ¨¡æ‹Ÿçš„è¯ï¼Œåœ¨ä»£ç æ‰§è¡Œå®Œä¹‹åï¼Œæ‰€æœ‰çš„å¾®ä»»åŠ¡å°±ä¼šç»§ç»­å…¨éƒ¨æ‰§è¡Œï¼Œä¸èƒ½åŠæ—¶çš„è®©å‡ºä¸»çº¿ç¨‹ã€‚")]),t._v(" "),a("ul",[a("li",[t._v("psï¼šè¿™ä¸¤ç§æ–¹æ³•éƒ½ä¸æ˜¯ polyfillï¼Œåªæ˜¯å°½å¯èƒ½é è¿‘ requestIdleCallbackï¼Œå¹¶ä¸”å‰©ä½™æ—¶é—´ä¹Ÿæ˜¯çŒœæµ‹çš„ã€‚")])]),t._v(" "),a("h2",{attrs:{id:"requestidlecallbackä¸reactä¸­çš„æ—¶é—´åˆ‡ç‰‡æœ‰ä»€ä¹ˆå…³ç³»"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#requestidlecallbackä¸reactä¸­çš„æ—¶é—´åˆ‡ç‰‡æœ‰ä»€ä¹ˆå…³ç³»"}},[t._v("#")]),t._v(" requestIdleCallbackä¸Reactä¸­çš„æ—¶é—´åˆ‡ç‰‡æœ‰ä»€ä¹ˆå…³ç³»")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/Linjiayu6/FE-RequestIdleCallback-demo",target:"_blank",rel:"noopener noreferrer"}},[t._v("RequestIdleCallback å®éªŒæ¡ˆä¾‹"),a("OutboundLink")],1)]),t._v(" "),a("ul",[a("li",[t._v("ç»“è®ºï¼š\n"),a("ul",[a("li",[t._v("requestIdleCallback æ˜¯åˆ©ç”¨å¸§ä¹‹é—´ç©ºé—²æ—¶é—´æ¥æ‰§è¡ŒJS")]),t._v(" "),a("li",[t._v("requestIdleCallback æ˜¯åœ¨ layout å’Œ paint ä¹‹å, æ„å‘³ç€requestIdleCallback æ˜¯å¯ä»¥jsè®¡ç®—å¹¶æ”¹å˜DOMçš„ï¼Œä¹Ÿå°±æ˜¯è¯´ä¼š è§¦å‘é‡æ–° layout å’Œ paint")]),t._v(" "),a("li",[t._v("requestAnimationFrame æ˜¯åœ¨ layout å’Œ paint ä¹‹å‰ï¼Œå› æ­¤æ›´é€‚åˆå˜æ›´DOMæ“ä½œã€‚")]),t._v(" "),a("li",[t._v("å› æ­¤Reactå†…éƒ¨å¯¹è°ƒåº¦ç­–ç•¥çš„å®ç°ä¹Ÿæ˜¯åŸºäºrequestAnimationFrameçš„")])])]),t._v(" "),a("li",[t._v("æ•…ï¼š\n"),a("ul",[a("li",[t._v("RequestIdleCallback å®šä½ä¸ºå¤„ç†ä¸é‡è¦ä¸”ä¸ç´§æ€¥çš„äº‹ç‰©ã€‚å› ä¸ºReactæ¸²æŸ“å†…å®¹ï¼Œå¹¶éæ˜¯ä¸é‡è¦ä¸”ä¸ç´§æ€¥ã€‚ä¸ä»…è¯¥apiå…¼å®¹ä¸€èˆ¬ï¼Œå¸§æ¸²æŸ“èƒ½åŠ›ä¸€èˆ¬ï¼Œä¹Ÿä¸å¤ªç¬¦åˆæ¸²æŸ“è¯‰æ±‚ï¼Œæ•…React å›¢é˜Ÿè‡ªè¡Œå®ç°")])])])]),t._v(" "),a("h3",{attrs:{id:"reactæºç ä¸­çš„requesthostcallback"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#reactæºç ä¸­çš„requesthostcallback"}},[t._v("#")]),t._v(" Reactæºç ä¸­çš„requestHostCallback")]),t._v(" "),a("ul",[a("li",[a("p",[a("a",{attrs:{href:"https://github.com/facebook/react/blob/v17.0.1/packages/scheduler/src/forks/SchedulerHostConfig.default.js",target:"_blank",rel:"noopener noreferrer"}},[t._v("SchedulerHostConfig.js"),a("OutboundLink")],1)])]),t._v(" "),a("li",[a("p",[t._v("æ‰§è¡Œå®ä»»åŠ¡(å›è°ƒä»»åŠ¡)")]),t._v(" "),a("ul",[a("li",[t._v("requestHostCallback: è§¦å‘ä¸€ä¸ªå®ä»»åŠ¡ performWorkUntilDeadlineã€‚")]),t._v(" "),a("li",[t._v("performWorkUntilDeadline: å®ä»»åŠ¡å¤„ç†ã€‚\n"),a("ul",[a("li",[t._v("æ˜¯å¦æœ‰å¯Œè£•æ—¶é—´, æœ‰åˆ™æ‰§è¡Œã€‚")]),t._v(" "),a("li",[t._v("æ‰§è¡Œè¯¥å›è°ƒä»»åŠ¡åï¼Œæ˜¯å¦è¿˜æœ‰ä¸‹ä¸€ä¸ªå›è°ƒä»»åŠ¡, å³åˆ¤æ–­ hasMoreWorkã€‚")]),t._v(" "),a("li",[t._v("æœ‰åˆ™ç»§ç»­æ‰§è¡Œ port.postMessage(null);")])])])])])]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" scheduledHostCallback "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" isMessageLoopRunning "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" channel "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MessageChannel")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// port2 å‘é€")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" port "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" channel"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("port2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// port1 æ¥æ”¶")]),t._v("\n  channel"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("port1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("onmessage "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" performWorkUntilDeadline"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("performWorkUntilDeadline")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æœ‰æ‰§è¡Œä»»åŠ¡")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("scheduledHostCallback "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" currentTime "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getCurrentTime")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Yield after `yieldInterval` ms, regardless of where we are in the vsync")]),t._v("\n\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// cycle. This means there's always time remaining at the beginning of")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// the message event.")]),t._v("\n\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// è®¡ç®—ä¸€å¸§çš„è¿‡æœŸæ—¶é—´ç‚¹")]),t._v("\n      deadline "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" currentTime "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" yieldInterval"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" hasTimeRemaining "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æ‰§è¡Œå®Œè¯¥å›è°ƒå, åˆ¤æ–­åç»­æ˜¯å¦è¿˜æœ‰å…¶ä»–ä»»åŠ¡")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" hasMoreWork "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("scheduledHostCallback")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n          hasTimeRemaining"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          currentTime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("hasMoreWork"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          isMessageLoopRunning "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n          scheduledHostCallback "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// If there's more work, schedule the next message event at the end")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// of the preceding one.")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// è¿˜æœ‰å…¶ä»–ä»»åŠ¡, æ¨è¿›è¿›å…¥ä¸‹ä¸€ä¸ªå®ä»»åŠ¡é˜Ÿåˆ—ä¸­")]),t._v("\n          port"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("postMessage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("error"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// If a scheduler task throws, exit the current browser task so the")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// error can be observed.")]),t._v("\n        port"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("postMessage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throw")]),t._v(" error"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      isMessageLoopRunning "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Yielding to the browser will give it a chance to paint, so we can")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// reset this.")]),t._v("\n    needsPaint "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// requestHostCallback ä¸€å¸§ä¸­æ‰§è¡Œä»»åŠ¡")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("requestHostCallback")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("callback")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å›è°ƒæ³¨å†Œ")]),t._v("\n    scheduledHostCallback "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" callback"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("isMessageLoopRunning"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      isMessageLoopRunning "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// è¿›å…¥å®ä»»åŠ¡é˜Ÿåˆ—")]),t._v("\n      port"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("postMessage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("cancelHostCallback")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    scheduledHostCallback "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br"),a("span",{staticClass:"line-number"},[t._v("24")]),a("br"),a("span",{staticClass:"line-number"},[t._v("25")]),a("br"),a("span",{staticClass:"line-number"},[t._v("26")]),a("br"),a("span",{staticClass:"line-number"},[t._v("27")]),a("br"),a("span",{staticClass:"line-number"},[t._v("28")]),a("br"),a("span",{staticClass:"line-number"},[t._v("29")]),a("br"),a("span",{staticClass:"line-number"},[t._v("30")]),a("br"),a("span",{staticClass:"line-number"},[t._v("31")]),a("br"),a("span",{staticClass:"line-number"},[t._v("32")]),a("br"),a("span",{staticClass:"line-number"},[t._v("33")]),a("br"),a("span",{staticClass:"line-number"},[t._v("34")]),a("br"),a("span",{staticClass:"line-number"},[t._v("35")]),a("br"),a("span",{staticClass:"line-number"},[t._v("36")]),a("br"),a("span",{staticClass:"line-number"},[t._v("37")]),a("br"),a("span",{staticClass:"line-number"},[t._v("38")]),a("br"),a("span",{staticClass:"line-number"},[t._v("39")]),a("br"),a("span",{staticClass:"line-number"},[t._v("40")]),a("br"),a("span",{staticClass:"line-number"},[t._v("41")]),a("br"),a("span",{staticClass:"line-number"},[t._v("42")]),a("br"),a("span",{staticClass:"line-number"},[t._v("43")]),a("br"),a("span",{staticClass:"line-number"},[t._v("44")]),a("br"),a("span",{staticClass:"line-number"},[t._v("45")]),a("br"),a("span",{staticClass:"line-number"},[t._v("46")]),a("br"),a("span",{staticClass:"line-number"},[t._v("47")]),a("br"),a("span",{staticClass:"line-number"},[t._v("48")]),a("br"),a("span",{staticClass:"line-number"},[t._v("49")]),a("br"),a("span",{staticClass:"line-number"},[t._v("50")]),a("br"),a("span",{staticClass:"line-number"},[t._v("51")]),a("br"),a("span",{staticClass:"line-number"},[t._v("52")]),a("br"),a("span",{staticClass:"line-number"},[t._v("53")]),a("br"),a("span",{staticClass:"line-number"},[t._v("54")]),a("br"),a("span",{staticClass:"line-number"},[t._v("55")]),a("br"),a("span",{staticClass:"line-number"},[t._v("56")]),a("br"),a("span",{staticClass:"line-number"},[t._v("57")]),a("br"),a("span",{staticClass:"line-number"},[t._v("58")]),a("br"),a("span",{staticClass:"line-number"},[t._v("59")]),a("br"),a("span",{staticClass:"line-number"},[t._v("60")]),a("br"),a("span",{staticClass:"line-number"},[t._v("61")]),a("br"),a("span",{staticClass:"line-number"},[t._v("62")]),a("br"),a("span",{staticClass:"line-number"},[t._v("63")]),a("br"),a("span",{staticClass:"line-number"},[t._v("64")]),a("br"),a("span",{staticClass:"line-number"},[t._v("65")]),a("br"),a("span",{staticClass:"line-number"},[t._v("66")]),a("br"),a("span",{staticClass:"line-number"},[t._v("67")]),a("br"),a("span",{staticClass:"line-number"},[t._v("68")]),a("br"),a("span",{staticClass:"line-number"},[t._v("69")]),a("br"),a("span",{staticClass:"line-number"},[t._v("70")]),a("br"),a("span",{staticClass:"line-number"},[t._v("71")]),a("br"),a("span",{staticClass:"line-number"},[t._v("72")]),a("br"),a("span",{staticClass:"line-number"},[t._v("73")]),a("br")])]),a("h2",{attrs:{id:"å‚è€ƒ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#å‚è€ƒ"}},[t._v("#")]),t._v(" å‚è€ƒ")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Window/requestIdleCallback",target:"_blank",rel:"noopener noreferrer"}},[t._v("requestIdleCallback-MDN"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://juejin.cn/post/7041457381938561055",target:"_blank",rel:"noopener noreferrer"}},[t._v("[Reactæºç ç¬”è®°]requestIdleCallbackæ˜¯ä»€ä¹ˆ"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://juejin.cn/post/7033959714794766372",target:"_blank",rel:"noopener noreferrer"}},[t._v("æ¥æ·±å…¥äº†è§£ä¸‹requestIdleCallback"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://juejin.cn/post/7021506472232583199",target:"_blank",rel:"noopener noreferrer"}},[t._v("å®ç° React requestIdleCallback è°ƒåº¦èƒ½åŠ›"),a("OutboundLink")],1)])])}),[],!1,null,null,null);s.default=e.exports}}]);